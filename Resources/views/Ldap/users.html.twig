{% extends "ClarolineCoreBundle:Administration:layout.html.twig" %}

{% block title %}{{ parent() ~ ' - LDAP ' ~ ' users' | trans({}, 'platform') | striptags | raw }}{% endblock %}

{% block breadcrumb %}
    {{
        macros.breadcrumbs([
            {
                'icon': 'fa fa-cog',
                'name': 'administration'|trans({}, 'platform'),
                'href': path('claro_admin_index')
            },
            {
                'name': 'parameters'|trans({}, 'platform'),
                'href': path('claro_admin_index')
            },
            {
                'name': 'LDAP'|trans({}, 'ldap'),
                'href': path('claro_admin_ldap')
            },
            {
                'name': 'Users and groups'|trans({}, 'ldap'),
                'href': path('claro_admin_ldap_servers')
            },
            {
                'name': 'users'|trans({}, 'platform'),
                'href': ''
            }
        ])
    }}
{% endblock %}

{% macro row(id, name) %}
    <div class="row margin-bottom-md">
        <div class="col-sm-3">
            <label for="{{ id }}">{{ name | trans({}, 'platform') }}:</label>
        </div>
        <div class="col-sm-9">
            <select class="form-control" id="{{ id }}"></select>
        </div>
    </div>
{% endmacro %}

{% block section_content %}
    {% import _self as select %}
    <div class="panel-heading">
        <h3 class="panel-title">{{  'LDAP - ' ~ 'users' | trans({}, 'platform') }}</h3>
    </div>
    <div class="panel-body">
        <form id='ldapForm'>
            {% if error is defined %}
                <div class="alert alert-danger">
                    <i class="fa fa-warning"></i> {{ 'ldap_error_conexion' | trans({}, 'ldap') }}
                </div>
                <a class="btn btn-primary" href="{{ path('claro_admin_ldap_settings') }}" class="alert-link">
                    <i class="fa fa-wrench"></i> {{ 'LDAP settings' | trans({}, 'ldap')}}
                </a>
            {% else %}
                <div class="row margin-bottom-md">
                    <div class="col-sm-3">
                        <label for="ldapObjectClass">{{ 'ldap_user_class' | trans({}, 'ldap') }}:</label>
                    </div>
                    <div class="col-sm-9">
                        <select class="form-control" id="ldapObjectClass" data-host="{{ host }}">
                            <option></option>
                            {% for objectClass in classes %}
                                <option>{{ objectClass }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="hide" id="ldapAttributes">
                    {{ select.row('userName', 'username') }}
                    {{ select.row('firstName', 'firstName') }}
                    {{ select.row('lastName', 'lastName') }}
                    {{ select.row('email', 'email') }}
                    {{ select.row('password', 'password') }}
                    {{ select.row('code', 'administrative_code') }}
                    {{ select.row('locale', 'Language') }}
                </div>
                <div class="hide table-responsive" id="ldapPreview">
                    <p class='text-muted'><i class="fa fa-eye"></i> {{ 'Preview' | trans({}, 'theme') }}</p>
                    <table class="table table-bordered">
                        <tr>
                            <th>{{ 'username' | trans({}, 'platform') }}</th>
                            <th>{{ 'firstName' | trans({}, 'platform') }}</th>
                            <th>{{ 'lastName' | trans({}, 'platform') }}</th>
                            <th>{{ 'email' | trans({}, 'platform') }}</th>
                            <th>{{ 'password' | trans({}, 'platform') }}</th>
                            <th>{{ 'administrative_code' | trans({}, 'platform') }}</th>
                            <th>{{ 'Language' | trans({}, 'platform') }}</th>
                        </tr>
                        {% for i in 1..5 %}
                            <tr id="user{{ i }}">
                                <td class="userName"></td>
                                <td class="firstName"></td>
                                <td class="lastName"></td>
                                <td class="email"></td>
                                <td class="password"></td>
                                <td class="code"></td>
                                <td class="locale"></td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            {% endif %}
        </form>
    </div>
    <div class="panel-footer text-right hide" id='ldapFooter'>
        <a class="btn btn-default" href="{{ path('claro_admin_ldap') }}">{{ 'cancel' | trans({}, 'platform') }}</a>
        <a class="btn btn-primary"><i class='fa fa-check'></i> {{ 'Save settings' | trans({}, 'ldap') }}</a>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('bundles/clarolineldap/js/ldap.js') }}"></script>
{% endblock %}

